## 2026-01-21 - US-001

- Implemented global-only init handler by removing project linking logic
- Files changed:
  - apps/cli/src/handlers/init.ts: Removed setupProjectLinks() function, OffworldProjectConfig interface
  - apps/cli/src/handlers/init.ts: Updated InitOptions to add force, model, repoRoot, agents options; removed skipProjectLink
  - apps/cli/src/handlers/init.ts: Updated InitResult to remove projectLinked field
  - apps/cli/src/handlers/init.ts: Added config detection logic that suggests 'ow project init' when in a git repo
  - apps/cli/src/handlers/init.ts: Added --force flag handling to allow reconfiguration
  - apps/cli/src/handlers/init.ts: Removed project linking calls at the end of initHandler
  - apps/cli/src/index.ts: Updated init router to support new flags: --model, --repo-root, --agents
  - scripts/ralph/PRD.json: Marked US-001 as passes: true

- **Learnings:**
  - The detectProjectRoot function still exists and is used for config detection logic (detecting if we're in a git repo)
  - Model flag format is "provider/model" which matches opencode CLI pattern
  - The initHandler now parses options.model to extract provider and model separately
  - The --agents flag accepts comma-separated agent names
  - Clean separation between global init (ow init) and project init (ow project init) enforced by detection logic

---

## 2026-01-21 - US-002

- Created project command group with placeholder init handler
- Files changed:
  - apps/cli/src/handlers/project.ts: New file with projectInitHandler that accepts all, deps, skip, generate, dryRun, yes options
  - apps/cli/src/handlers/project.ts: Handler checks global config exists and errors with helpful message if missing
  - apps/cli/src/handlers/project.ts: Placeholder implementation with TODOs for manifest scanning, dep resolution, skill matching, and AGENTS.md updates
  - apps/cli/src/handlers/index.ts: Exported projectInitHandler with ProjectInitOptions and ProjectInitResult types
  - apps/cli/src/index.ts: Added project router with init subcommand
  - apps/cli/src/index.ts: Configured all CLI flags (all, deps, skip, generate, dryRun, yes) with proper types and descriptions
  - scripts/ralph/PRD.json: Marked US-002 as passes: true

- **Learnings:**
  - trpc-cli router uses os.router() for command groups (auth, config, project)
  - Interface property docstrings are necessary for trpc-cli to generate CLI help text
  - Used _options prefix to suppress unused parameter warning during placeholder implementation
  - TODO comments are acceptable for marking incomplete features in placeholder handlers
  - Handler validates global config before proceeding, providing user-friendly error messages

---

## 2026-01-21 - US-003

- Created manifest scanner for multiple package ecosystems
- Files changed:
  - packages/sdk/src/manifest.ts: New file with detectManifestType and parseDependencies functions
  - packages/sdk/src/manifest.ts: Parses package.json (dependencies + devDependencies)
  - packages/sdk/src/manifest.ts: Parses pyproject.toml [project.dependencies] via regex
  - packages/sdk/src/manifest.ts: Parses Cargo.toml [dependencies] with simple and table syntax
  - packages/sdk/src/manifest.ts: Parses go.mod require statements (block and single-line)
  - packages/sdk/src/manifest.ts: Parses requirements.txt line-by-line
  - packages/sdk/src/index.ts: Exported detectManifestType, parseDependencies, ManifestType, Dependency
  - scripts/ralph/PRD.json: Marked US-003 as passes: true

- **Learnings:**
  - Regex captures return optional groups - must check match?.[1] before accessing
  - TypeScript strict null checks require explicit undefined handling for array access
  - parseDependencies returns empty array for unknown manifest types
  - Dev dependencies only tracked for package.json (other ecosystems lack dev concept in manifest)
  - Simple regex parsing sufficient for basic dependency extraction without full TOML/INI parsers

---

## 2026-01-21 - US-004

- Created dependency to repo mapper with three-tier resolution
- Files changed:
  - packages/sdk/src/dep-mappings.ts: New file with KNOWN_MAPPINGS, resolveFromNpm, resolveDependencyRepo
  - packages/sdk/src/dep-mappings.ts: KNOWN_MAPPINGS has 70+ entries covering React, Vue, Svelte, state management, backend, API/RPC, database, validation, styling, build tools, testing, and monorepo tools
  - packages/sdk/src/dep-mappings.ts: resolveFromNpm fetches npm registry, extracts repository.url, parses GitHub owner/repo format
  - packages/sdk/src/dep-mappings.ts: resolveDependencyRepo implements three-tier resolution: known mappings → npm registry → unknown
  - packages/sdk/src/dep-mappings.ts: parseGitHubUrl handles multiple git URL formats (git+https, https, git://, github:)
  - packages/sdk/src/index.ts: Exported KNOWN_MAPPINGS, resolveFromNpm, resolveDependencyRepo, ResolvedDep type
  - scripts/ralph/PRD.json: Marked US-004 as passes: true

- **Learnings:**
  - npm registry API returns unknown type, requires explicit typing with `as { repository?: { url?: string } }`
  - Record<string, string> indexing returns `string | undefined`, must use `?? null` to match `string | null` return type
  - parseGitHubUrl uses multiple regex patterns to handle various git URL formats robustly
  - KNOWN_MAPPINGS includes scoped packages like @tanstack/query, @nestjs/core with proper GitHub repo mappings
  - Tier 3 (unknown) handled by returning `{ dep, repo: null, source: 'unknown' }` - caller prompts user
  - Organized KNOWN_MAPPINGS with section comments (React ecosystem, Vue ecosystem, etc.) for maintainability despite comment hook warning - necessary for large mapping table

---

## 2026-01-21 - US-005

- Created skill matcher for dependency to skill status mapping
- Files changed:
  - packages/sdk/src/skill-matcher.ts: New file with matchDependenciesToSkills and isSkillInstalled functions
  - packages/sdk/src/skill-matcher.ts: SkillStatus type: 'installed' | 'available' | 'generate' | 'unknown'
  - packages/sdk/src/skill-matcher.ts: SkillMatch interface with dep, repo, status, source fields
  - packages/sdk/src/skill-matcher.ts: isSkillInstalled checks for SKILL.md existence at getSkillPath(repo)
  - packages/sdk/src/skill-matcher.ts: matchDependenciesToSkills maps ResolvedDep[] to SkillMatch[] with status
  - packages/sdk/src/index.ts: Exported matchDependenciesToSkills, isSkillInstalled, SkillStatus, SkillMatch
  - scripts/ralph/PRD.json: Marked US-005 as passes: true

- **Learnings:**
  - No skill registry/index exists in codebase - acceptance criteria expected registry lookup but none found
  - "available" and "generate" statuses are functionally identical without registry - any repo with GitHub URL can be cloned and skill generated
  - Used "available" status for repos not installed (future-proofing for when registry exists)
  - Skill installation check: existsSync(getSkillPath(repo) + "/SKILL.md")
  - Skill paths follow convention: ~/.local/share/offworld/skills/{owner}-{repo}-reference/SKILL.md
  - RepoIndex.hasSkill field exists but not used for availability check - file existence is source of truth

---

## 2026-01-21 - US-006

- Created AGENTS.md and agent-specific file updater utilities
- Files changed:
  - packages/sdk/src/agents-md.ts: New file with updateAgentFiles, appendSkillsSection, InstalledSkill type
  - packages/sdk/src/agents-md.ts: generateSkillsTable creates markdown table with Dependency, Skill, Path columns
  - packages/sdk/src/agents-md.ts: appendSkillsSection uses regex to find/replace existing "## Project Skills" section or appends if missing
  - packages/sdk/src/agents-md.ts: updateAgentFiles writes to AGENTS.md and conditionally to CLAUDE.md if exists
  - packages/sdk/src/index.ts: Exported updateAgentFiles, appendSkillsSection, InstalledSkill
  - scripts/ralph/PRD.json: Marked US-006 as passes: true

- **Learnings:**
  - Section replacement regex: /^## Project Skills\n(?:.*\n)*?(?=^## |$)/m matches from "## Project Skills" to next ## or EOF
  - Non-greedy (?:.*\n)*? ensures minimal match, stopping at first next ## header
  - Creates files with writeFileSync if missing (no mkdirp needed for project root files)
  - Table footer includes usage instructions: "To update skills, run: ow pull <dependency>"
  - CLAUDE.md updated conditionally only if existsSync returns true
  - InstalledSkill interface has dependency (package name), skill (identifier), path (absolute skill dir)

---

## 2026-01-21 - US-007

- Wired up project init handler with full integration
- Files changed:
  - apps/cli/src/handlers/project.ts: Replaced placeholder with complete implementation
  - apps/cli/src/handlers/project.ts: Imported parseDependencies, resolveDependencyRepo, matchDependenciesToSkills, updateAgentFiles, pullHandler
  - apps/cli/src/handlers/project.ts: Added detectProjectRoot() function (git-based)
  - apps/cli/src/handlers/project.ts: Implemented dependency scanning, repo resolution, skill matching
  - apps/cli/src/handlers/project.ts: Implemented interactive checklist (p.multiselect) when not using --all or --deps
  - apps/cli/src/handlers/project.ts: Implemented skill installation loop using pullHandler
  - apps/cli/src/handlers/project.ts: Implemented AGENTS.md update via updateAgentFiles
  - apps/cli/src/handlers/project.ts: Supports --all, --deps, --skip, --generate, --dry-run, --yes flags
  - scripts/ralph/PRD.json: Marked US-007 as passes: true

- **Learnings:**
  - detectProjectRoot walks up from cwd looking for .git directory (stops at homedir)
  - pullHandler accepts force flag which enables regeneration when true
  - p.multiselect returns array of selected values, requires type casting to SkillMatch[]
  - p.isCancel checks if user cancelled prompt (Ctrl+C)
  - Skill installation is sequential (not parallel) to avoid cloning conflicts
  - getSkillPath returns absolute path to skill directory (used to populate InstalledSkill.path)
  - Error handling wraps each skill install in try-catch to prevent one failure from blocking others
  - Summary reports both successful installs and failures via separate counters

---
