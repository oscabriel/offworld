## 2026-01-15 - US-001

- Created `packages/sdk/src/generate.ts` with AI-only skill generation
- Implemented `generateSkillWithAI(repoPath, repoName, options)` function
- Implemented `installSkill(repoName, skillContent, meta)` function
- Uses `streamPrompt()` from `ai/opencode.ts` with `analyze` agent
- Single comprehensive prompt instructs AI to use Read/Grep/Glob tools
- Returns `{ skillContent, commitSha }` for generated skills
- Supports provider, model, onDebug, onStream options
- Updated `packages/sdk/AGENTS.md` with new patterns

**Files changed:**
- `packages/sdk/src/generate.ts` (new)
- `packages/sdk/AGENTS.md` (updated)

**Learnings:**
- Reusing `streamPrompt()` from existing opencode.ts avoids duplication
- `toSkillDirName()` and `toMetaDirName()` duplicated from pipeline.ts (intentional - pipeline.ts will be deleted in later stories)
- Simpler output structure: SKILL.md + meta.json only (no references/ subdirectory needed for AI-only approach)
- Pre-existing test failures in SDK don't block typecheck

---

## 2026-01-15 - US-002

- Exported `installSkill` and `generateSkillWithAI` from `packages/sdk/src/index.ts`
- Added type exports: `GenerateSkillOptions`, `GenerateSkillResult`, `InstallSkillMeta`
- Updated AGENTS.md with export pattern documentation

**Files changed:**
- `packages/sdk/src/index.ts` (updated)
- `packages/sdk/AGENTS.md` (updated)

**Learnings:**
- `installSkill` was already fully implemented in US-001, just needed export from index.ts
- Keep `installSkillWithReferences` export for backward compatibility until analysis/ directory is deleted

---

## 2026-01-15 - US-003

- Deleted `packages/sdk/src/analysis/` directory (12 files)
- Removed analysis exports from `packages/sdk/src/index.ts`
- Deleted orphaned validation files: `consistency.ts`, `quality.ts` (depended on analysis types)
- Deleted test files importing analysis/: `analysis.test.ts`, `parsers.test.ts`, `pipeline.integration.test.ts`
- Updated AGENTS.md - removed obsolete analysis sections, added deletion learnings

**Files changed:**
- `packages/sdk/src/analysis/` (deleted - 12 files)
- `packages/sdk/src/validation/consistency.ts` (deleted)
- `packages/sdk/src/validation/quality.ts` (deleted)
- `packages/sdk/src/__tests__/analysis.test.ts` (deleted)
- `packages/sdk/src/__tests__/parsers.test.ts` (deleted)
- `packages/sdk/src/__tests__/pipeline.integration.test.ts` (deleted)
- `packages/sdk/src/index.ts` (updated)
- `packages/sdk/AGENTS.md` (updated)

**Learnings:**
- validation/consistency.ts and quality.ts imported from analysis/ but were not exported from validation/index.ts - dead code
- Test files that directly import deleted modules must be deleted, not refactored
- Cascade deletions: when removing a module, check what else imports it (grep for import patterns)
- 6600+ lines deleted - significant reduction in SDK complexity

---

## 2026-01-15 - US-004

- Deleted `packages/sdk/src/ast/` directory (3 files)
- No import cleanup needed - analysis/ was the only consumer

**Files changed:**
- `packages/sdk/src/ast/` (deleted - 3 files: parser.ts, patterns.ts, index.ts)
- `packages/sdk/AGENTS.md` (updated)

**Learnings:**
- Clean deletion when dependent module already removed - no cascade effects
- ~1100 lines deleted
- AST parsing was tightly coupled to analysis/ - removing analysis/ first made this trivial

---

## 2026-01-15 - US-005

- Deleted `packages/sdk/src/validation/` directory (3 files)
- Removed validation exports from `packages/sdk/src/index.ts`
- Deleted `validation.test.ts` test file

**Files changed:**
- `packages/sdk/src/validation/` (deleted - 3 files: staleness.ts, paths.ts, index.ts)
- `packages/sdk/src/__tests__/validation.test.ts` (deleted)
- `packages/sdk/src/index.ts` (updated)
- `packages/sdk/AGENTS.md` (updated)

**Learnings:**
- consistency.ts and quality.ts were already deleted in US-003 (depended on analysis/ types)
- Only staleness.ts, paths.ts, index.ts remained after US-003
- ~400 lines deleted
- Validation was only used for deterministic analysis caching - not needed for AI-only approach

---

## 2026-01-15 - US-006

- Removed all @ast-grep dependencies from `packages/sdk/package.json`
- Ran `bun install` to update lockfile
- Manually removed stale symlinks in `packages/sdk/node_modules/@ast-grep/`
- Verified no ast-grep packages remain in node_modules

**Files changed:**
- `packages/sdk/package.json` (updated - 9 deps removed)
- `bun.lock` (updated - 47 lines removed)
- `packages/sdk/AGENTS.md` (updated)

**Learnings:**
- Bun preserves symlinks to hoisted deps even after removing from package.json
- Must `rm -rf` stale symlink directory then re-run `bun install` for clean state
- 9 ast-grep packages removed: napi + 8 language bindings (python, rust, go, java, c, cpp, ruby, php)

---

## 2026-01-15 - US-007

- Verified SDK index.ts exports are correct (verification-only story)
- No code changes to index.ts needed - all criteria already satisfied from previous stories
- Typecheck passes, `bun run build` succeeds (55.53 kB bundle)
- Updated AGENTS.md with public API summary table

**Files changed:**
- `packages/sdk/AGENTS.md` (updated - added exports summary)

**Learnings:**
- Some stories are verification-only (criteria already met from previous work)
- Always run `bun run build` in packages/sdk to confirm bundle builds cleanly
- SDK bundle is ~55kB after stripping analysis code (down from larger size with AST deps)

---

## 2026-01-15 - US-008

- Verified CLI generate handler already uses simplified SDK functions (verification-only story)
- Handler correctly imports `generateSkillWithAI` and `installSkill` from `@offworld/sdk`
- No old analysis imports present (`runAnalysisPipeline`, `formatSkillMd`, etc.)
- Handler flow: parse input → check remote → clone if needed → generateSkillWithAI → installSkill → updateIndex
- All tests pass (237 SDK, 23 CLI, 56 types, 14 backend)

**Files changed:**
- `scripts/ralph/PRD.json` (updated - US-008 passes: true)

**Learnings:**
- CLI handler was already refactored when US-001 was implemented (generate.ts created the new functions)
- Handler preserves full flow: remote existence check, clone for remote repos, local path for local repos
- `getSkillPath()` provides skill path for user feedback before install
- `updateIndex()` only updates if entry exists (preserves existing index behavior)

---

## 2026-01-15 - US-009

- Simplified SkillSchema in `packages/types/src/schemas.ts`
- Only `name` and `description` are now required fields
- All other fields (whenToUse, bestPractices, quickPaths, searchPatterns, etc.) made optional
- Updated schema tests to reflect new optional field behavior
- Updated root AGENTS.md with types package learnings

**Files changed:**
- `packages/types/src/schemas.ts` (updated - SkillSchema simplified)
- `packages/types/src/__tests__/schemas.test.ts` (updated - 5 tests modified)
- `AGENTS.md` (updated - added types package section)

**Learnings:**
- ArchitectureSchema and FileIndexSchema cannot be removed - still used by sync.ts, plugin, push.ts, backend
- ParsedFile and DependencyGraph types were already removed (no references found)
- API compatibility requires keeping optional legacy fields (quickPaths, searchPatterns) for remote responses
- Backend Convex schema has its own definitions that mirror @offworld/types - not auto-synced
- Test fixtures in CLI handlers.test.ts use full skill objects - work fine since fields are now optional

---

## 2026-01-15 - US-010

- Deleted `reference-quality.test.ts` (tested removed API surface quality functions)
- Deleted `__tests__/fixtures/` directory (10 files: sample code files for AST parsing tests)
- Verified all 227 SDK tests still pass
- Updated AGENTS.md with test cleanup documentation

**Files changed:**
- `packages/sdk/src/__tests__/reference-quality.test.ts` (deleted)
- `packages/sdk/src/__tests__/fixtures/` (deleted - 10 files)
- `packages/sdk/AGENTS.md` (updated)

**Learnings:**
- `reference-quality.test.ts` defined test implementations inline (not importing from SDK) - was dead code after removing API surface functionality
- Fixtures were only imported by analysis/parser tests deleted in US-003 - no other tests used them
- `mocks/` directory still needed by remaining tests (fs.ts, git.ts, fetch.ts)
- Most analysis-related test files (analysis.test.ts, parsers.test.ts, etc.) were already deleted in earlier stories (US-003, US-005)
- ~770 lines deleted

---

## 2026-01-15 - US-011

- Rewrote `packages/sdk/AGENTS.md` to remove all analysis-related learnings
- Removed sections: Analysis Directory Deletion, AST Directory Deletion, Validation Directory Deletion, AST-grep Dependencies Removal, Test Cleanup (these were about removed functionality)
- Removed US-XXX tags from section headers (no longer relevant)
- Kept sections: OpenCode Integration Patterns, Provider/Model Validation, Error Types, Stream Events
- Enhanced documentation for `generateSkillWithAI` and `installSkill` with detailed interface documentation
- Added Public API Summary table
- Consolidated Gotchas section (removed analysis-specific gotchas)

**Files changed:**
- `packages/sdk/AGENTS.md` (rewritten - 61 insertions, 125 deletions)

**Learnings:**
- AGENTS.md should document current functionality, not deleted functionality
- After major refactoring, AGENTS.md needs cleanup to remove obsolete information
- US-XXX tags in section headers are useful during development but should be removed afterward
- Keeping detailed interface documentation (types, parameters) in AGENTS.md is valuable for future AI agents

---

## 2026-01-15 - US-014

- Verified no analysis code remains in SDK (verification-only story)
- All grep checks pass: no references to buildSkeleton, buildArchitectureGraph, extractAPISurface, buildDependencyGraph, rankFilesWithAST, parseFile, or @ast-grep
- Typecheck passes across all packages
- SDK build succeeds (55.53 kB bundle)
- Note: docs build has unrelated Zod v4/Astro compatibility issue - not related to analysis code removal

**Files changed:**
- `scripts/ralph/PRD.json` (updated - US-001 and US-014 passes: true)

**Learnings:**
- Verification stories confirm work from previous stories - no code changes needed
- PRD.json should be updated immediately after each story (US-001 was missed in earlier sessions)
- Docs app build failure is unrelated to SDK changes - Zod v4 incompatibility with Astro Starlight

---
