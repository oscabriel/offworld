## 2026-01-10: PRD-001, PRD-002 - Remove tree-sitter, add heuristics

### Completed
- PRD-001: Removed tree-sitter dependency
- PRD-002: Implemented heuristics-based file scoring

### Changes
- Deleted `/packages/sdk/src/importance/` (parser.ts, queries.ts, ranker.ts, index.ts)
- Deleted `/packages/sdk/src/__tests__/importance.test.ts`
- Created `/packages/sdk/src/analysis/heuristics.ts` - path-based scoring:
  - Entry points: 0.9, Config: 0.8, Types: 0.75, Source: 0.6-0.7, Tests: 0.3
- Updated `context.ts`, `pipeline.ts` to use `rankFilesByHeuristics`
- Updated `index.ts` to export heuristics instead of tree-sitter
- Removed `web-tree-sitter` from package.json
- Fixed tests: analysis.test.ts, pipeline.test.ts, pipeline-io.test.ts

### Decisions
- Scoring uses pure path heuristics, no parsing
- Default limits: maxFiles=500, maxFileSize=100KB (down from 10000/1MB)
- Tests mock `rankFilesByHeuristics` and `generateRichSkill`

### Verification
- TypeScript: passes
- Tests: 391 passed
- Lint: 0 errors

---

## 2026-01-10: PRD-003 - Combine summary+architecture into single AI call

### Completed
- PRD-003: Combined AI calls (3â†’2)

### Changes
- Added `SUMMARY_ARCHITECTURE_TEMPLATE` to prompts.ts with "=== SECTION ===" delimiters
- Added `generateSummaryAndArchitecture()` to generate.ts
- Added `parseSummaryAndArchitecture()` parser using delimiter extraction
- Updated pipeline.ts: replaced separate calls with combined `analyze` step
- Updated tests: mocks, progress step assertions

### Decisions
- Delimiter format: `=== SUMMARY ===` and `=== ARCHITECTURE ===`
- Fallback: split at midpoint if delimiters missing
- Progress step renamed from "summary"/"architecture" to "analyze"

### Verification
- TypeScript: passes
- Tests: 391 passed
- Lint: 0 errors

---

## 2026-01-10: PRD-004 - Optional architecture generation

### Completed
- PRD-004: Added `--skip-architecture` flag for faster summary-only mode

### Changes
- `packages/sdk/src/analysis/pipeline.ts`:
  - Added `includeArchitecture?: boolean` option (default: true)
  - Architecture fields now nullable in `AnalysisPipelineResult`
  - Conditional save: skip architecture.json/md when null
  - Uses `generateSummary()` when architecture skipped
- `packages/sdk/src/analysis/generate.ts`:
  - `generateRichSkill()` accepts `Architecture | null`
- `packages/sdk/src/analysis/prompts.ts`:
  - `createSkillPrompt()` handles null architectureJson
- `apps/cli/src/handlers/generate.ts`, `pull.ts`:
  - Added `skipArchitecture` option
- `apps/cli/src/index.ts`:
  - Added `--skip-architecture` flag to `generate` and `pull` commands

### Decisions
- Default is `includeArchitecture: true` for backward compat
- Skill generation still works without architecture (just excludes arch section)

### Verification
- TypeScript: SDK/CLI pass (web has pre-existing errors)
- Tests: 391 passed
- Lint: 0 errors

---

## 2026-01-10: PRD-006/007/008 - Update skill frontmatter

### Completed
- PRD-006: Remove allowed-tools from frontmatter
- PRD-007: Add commit SHA (7-char) to frontmatter
- PRD-008: Add generated date (YYYY-MM-DD) to frontmatter

### Changes
- `packages/sdk/src/analysis/generate.ts`:
  - `FormatSkillOptions` interface with commitSha/generated
  - `formatSkillMd()` now accepts options, outputs commit/generated fields
  - `injectSkillMetadata()` post-processes AI output to add fields
  - `SkillGenerateOptions` extended with commitSha/generated
- `packages/sdk/src/analysis/prompts.ts`:
  - Removed `allowed-tools: [Read, Grep, Glob, Task]` from template
- `packages/sdk/src/analysis/pipeline.ts`:
  - Passes commitSha and generated date to skill generation
- `apps/cli/src/handlers/pull.ts`:
  - Updated `formatSkillMd()` with same signature
  - Added `loadLocalMeta()` helper
  - All formatSkillMd calls now pass metadata

### Tests updated
- skill.test.ts: Tests for commit/generated, no allowed-tools
- generate.test.ts: Updated formatSkillMd assertions

### Verification
- TypeScript: SDK/CLI pass
- Tests: 392 passed (+1)
- Lint: 0 errors
