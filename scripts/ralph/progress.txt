## 2026-01-14 - US-001

- Updated toSkillDirName() to collapse owner==repo
- Updated toMetaDirName() for consistency
- Files changed: packages/sdk/src/analysis/pipeline.ts
- **Learnings:**
  - TypeScript strict: array destructuring from split() needs type assertion `as [string, string]` when checked by includes() guard

---

## 2026-01-14 - US-002

- Installed @ast-grep/lang-c
- Added .c, .h extensions to LANG_MAP
- Added "c" to SupportedLang, PatternLanguage types
- Registered C in initLanguages()
- Added AST patterns for C: function, struct, #include
- Files changed: packages/sdk/src/ast/index.ts, packages/sdk/src/ast/patterns.ts, packages/sdk/package.json
- **Learnings:**
  - When adding PatternLanguage, must update ALL Record<PatternLanguage, ...> (5 total)
  - struct patterns may not match all forms - typedef struct differs from named struct

---

## 2026-01-14 - US-003

- Installed @ast-grep/lang-cpp
- Added .cpp, .cc, .cxx, .hpp, .hxx extensions to LANG_MAP
- Added "cpp" to SupportedLang, PatternLanguage types
- Registered C++ in initLanguages()
- Added AST patterns for C++: class, namespace, inheritance, templates
- Files changed: packages/sdk/src/ast/index.ts, packages/sdk/src/ast/patterns.ts, packages/sdk/package.json
- **Learnings:**
  - namespace detected as class due to pattern structure similarity
  - C++ methods inside classes not detected with current patterns

---

## 2026-01-14 - US-004

- Added Ruby language support (package already installed)
- Added .rb extension to LANG_MAP
- Added "ruby" to SupportedLang, PatternLanguage types
- Registered Ruby in initLanguages()
- Added AST patterns for Ruby: def, class, module, require/require_relative/load
- Files changed: packages/sdk/src/ast/index.ts, packages/sdk/src/ast/patterns.ts
- **Learnings:**
  - Ruby method patterns use `end` keyword (unlike Python which uses indentation)
  - Ruby has both require and require_relative for imports
  - module in Ruby is similar to namespace - grouped with class patterns

---

## 2026-01-14 - US-005

- Installed @ast-grep/lang-php
- Added .php extension to LANG_MAP
- Added "php" to SupportedLang, PatternLanguage types
- Registered PHP in initLanguages()
- Added AST patterns for PHP: function (public/private/protected/static), class, interface, trait, use, require/require_once/include/include_once
- Files changed: packages/sdk/src/ast/index.ts, packages/sdk/src/ast/patterns.ts, packages/sdk/package.json
- **Learnings:**
  - PHP has trait as a class-like construct (similar to Ruby mixins)
  - PHP namespaces use backslash separator: `use Namespace\Class`
  - PHP has 4 include variants: require, require_once, include, include_once

---

## 2026-01-14 - US-006

- Added ArchitectureSection interface with entryPoints, coreModules, hubs, layers, inheritance, directoryTree, findingTable, packages
- Implemented buildArchitectureSection() extracting architecture from parsedFiles + dependencyGraph
- Implemented formatArchitectureMd() generating full markdown with tables and Mermaid diagrams
- Renamed old formatArchitectureMd to formatArchitectureMdLegacy in pipeline.ts
- Updated index.ts exports with new types and functions
- Files changed: packages/sdk/src/analysis/architecture.ts, packages/sdk/src/analysis/index.ts, packages/sdk/src/analysis/pipeline.ts, packages/sdk/AGENTS.md
- **Learnings:**
  - Export naming conflicts: check index.ts before adding functions with common names
  - Entry point detection uses regex patterns on file paths (main, cli, server, worker, index, config)
  - Hub threshold of 3+ importers is standard for identifying dependency hubs
  - Monorepo detection looks for packages/*/apps/*/libs/* prefixes
  - Layer diagram is simplified flowchart showing layer counts, not raw file-level imports

---

## 2026-01-14 - US-007

- Created api-surface.ts with APISurface, PublicExport, ImportPattern, SubpathExport interfaces
- Implemented extractAPISurface() reading package.json exports, finding entry points, extracting symbols
- Implemented formatAPISurfaceMd() generating Import Patterns, Public Exports, Subpath Exports, Type Exports tables
- Files changed: packages/sdk/src/analysis/api-surface.ts, packages/sdk/src/analysis/index.ts, packages/sdk/AGENTS.md
- **Learnings:**
  - Entry point detection order: package.json exports > main/module > common patterns (src/index.ts)
  - resolveExportPath handles object exports with priority: import > require > default > types
  - Description inference uses name patterns (create*, use*, get*, is*) for automatic descriptions
  - typeExports separate from exports to distinguish runtime values from type-only exports

---

## 2026-01-14 - US-008

- Added ProseGenerationContext interface with apiSurface, architecture, readme, examples, contributing fields
- Added generateProseWithContext() function that generates all three AI prose outputs
- Added SkillProse, SummaryContent, DevelopmentProse schemas with Zod validation
- Created buildSkillPromptWithContext() including API Surface + Architecture sections
- Created buildSummaryPromptWithContext() including API Surface + README + Examples
- Created buildDevelopmentPromptWithContext() including Architecture + CONTRIBUTING
- Files changed: packages/sdk/src/analysis/prose.ts, packages/sdk/src/analysis/index.ts, packages/sdk/AGENTS.md
- **Learnings:**
  - Name conflicts: SummaryProse already existed in pipeline.ts - renamed new type to SummaryContent
  - Context formatting functions truncate long content (2000 chars for readme/contributing, 1500 for examples)
  - Import verbatim enforcement: prompts explicitly tell AI to use exact imports from API Surface
  - Prompt structure: each prompt type gets deterministic context relevant to that file type

---

## 2026-01-14 - US-009

- Reordered pipeline: deterministic generation (architecture, API surface) now runs BEFORE AI prose
- Added loadReadme(), loadExamples(), loadContributing() helper functions
- Updated AnalysisPipelineResult to include architectureSection, apiSurface, architectureMd, apiSurfaceMd, proseResult
- Pipeline now passes ProseGenerationContext to generateProseWithContext()
- Created legacy prose adapter for backward compatibility with mergeProseIntoSkeleton()
- Removed generateProseWithRetry import (replaced by generateProseWithContext)
- Files changed: packages/sdk/src/analysis/pipeline.ts, packages/sdk/src/analysis/index.ts, packages/sdk/AGENTS.md
- **Learnings:**
  - Pipeline flow: deterministic extraction MUST happen before AI to populate context
  - Legacy adapter pattern: when switching to new prose format, create adapter object for existing merge functions
  - Context loaders: return undefined (not throw) when files not found, use onDebug for error visibility
  - loadExamples checks multiple patterns: directories (examples/, demos/) then individual files (example.ts)

---

## 2026-01-14 - US-010

- Added apiReferenceContent and developmentContent to InstallSkillOptions interface (optional fields)
- Updated installSkillWithReferences() to conditionally write api-reference.md and development.md
- Updated SKILL.md "See also" links to include all 4 reference files
- Fixed broken callers: exported formatArchitectureMdLegacy from SDK, updated plugin/CLI to use it
- Files changed: packages/sdk/src/analysis/pipeline.ts, packages/sdk/src/index.ts, packages/plugin/src/index.ts, apps/cli/src/handlers/generate.ts, apps/cli/src/handlers/pull.ts, packages/sdk/AGENTS.md
- **Learnings:**
  - Making new interface fields optional maintains backward compatibility with existing callers
  - Turbo cache can hide type errors - run `bunx turbo typecheck --force` or rebuild SDK to catch issues
  - When renaming exports (e.g., formatArchitectureMd â†’ formatArchitectureMdLegacy), must add new name to SDK index.ts exports
  - Conditional file writes: use `if (content) { writeFileSync(...) }` to handle optional fields

---
